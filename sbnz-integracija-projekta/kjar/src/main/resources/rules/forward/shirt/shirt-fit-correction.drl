package forward

import com.ftn.sbnz.model.models.ShirtFabric
import com.ftn.sbnz.model.models.Recommendation
import com.ftn.sbnz.model.models.FabricRecommendation

// ---------------------------------------------
//  SHIRT FIT CORRECTION â€” transforms Recommendation â†’ FabricRecommendation
// ---------------------------------------------

// a. Loose fit â†’ +10%
rule "Shirt fit: Loose (+10%)"
    salience 75
    no-loop true
when
    $sf : ShirtFabric(shirt.fit == "LOOSE")
    $rec : Recommendation(fabric == $sf.fabric)
then
    double newLen = $rec.getRequiredLength() * 1.10;
    FabricRecommendation fr = new FabricRecommendation(
        $rec.getFabric(),
        newLen,
        $rec.getNote() + " Loose kroj â€” poveÄ‡ana metraÅ¾a za +10%.",
        "Shirt",
        ""
    );
    insert(fr);
    System.out.println("ðŸ‘• [Shirt] Loose fit â†’ +10% â†’ FabricRecommendation created.");
end


// b. Slim fit + stretch â‰¥ 10% â†’ -0.1 m
rule "Shirt fit: Slim with stretch â‰¥ 10%"
    salience 74
    no-loop true
when
    $sf : ShirtFabric(
        shirt.fit == "SLIM",
        fabric.stretchPercentage >= 10
    )
    $rec : Recommendation(fabric == $sf.fabric)
then
    double newLen = $rec.getRequiredLength() - 0.1;
    FabricRecommendation fr = new FabricRecommendation(
        $rec.getFabric(),
        newLen,
        $rec.getNote() + " Slim kroj, rastegljiv materijal â€” smanjena metraÅ¾a za 0.1 m.",
        "Shirt",
        ""
    );
    insert(fr);
    System.out.println("ðŸ‘• [Shirt] Slim fit (stretch â‰¥10%) â†’ -0.1 m â†’ FabricRecommendation created.");
end


// c. Slim fit + stretch < 10% â†’ unsuitable â†’ remove Recommendation
rule "Shirt fit: Slim with stretch < 10%"
    salience 74
when
    $sf : ShirtFabric(
        shirt.fit == "SLIM",
        fabric.stretchPercentage < 10
    )
    $rec : Recommendation(fabric == $sf.fabric)
then
    System.out.println("âš ï¸ [Shirt] Slim fit not suitable (stretch <10%) â†’ Recommendation removed.");
    retract($rec);
end


// d. Standard fit â†’ keep base as is â†’ create FabricRecommendation
rule "Shirt fit: Standard (no correction)"
    salience 73
when
    $sf : ShirtFabric(shirt.fit == "STANDARD")
    $rec : Recommendation(fabric == $sf.fabric)
then
    FabricRecommendation fr = new FabricRecommendation(
        $rec.getFabric(),
        $rec.getRequiredLength(),
        $rec.getNote() + " Standard kroj â€” bez korekcije metraÅ¾e.",
        "Shirt",
        $sf.getShirt().getFit()
    );
    insert(fr);
    System.out.println("ðŸ‘• [Shirt] Standard fit â†’ FabricRecommendation created.");
end
